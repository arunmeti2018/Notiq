<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Placement Prep Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Add markdown-it for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
    <!-- Add highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <!-- Add Configuration -->
    <!-- <script src="config.js"></script> -->
    <style>
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .tab-button.active {
            background-color: #3b82f6;
            color: white;
        }

        .progress-bar {
            transition: width 0.3s ease;
        }

        .spinner {
            border: 2px solid #f3f4f6;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notes-container {
            max-height: 400px;
            overflow-y: auto;
        }

        .topic-item {
            transition: all 0.3s ease;
        }

        .topic-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        /* Enhanced Dark Mode Styles */
        .dark {
            color-scheme: dark;
        }

        .dark body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e2e8f0;
        }

        .dark .bg-white {
            background-color: #1e293b;
            color: #e2e8f0;
        }

        .dark .text-gray-600 {
            color: #94a3b8;
        }

        .dark .text-gray-900 {
            color: #f1f5f9;
        }

        .dark .border {
            border-color: #334155;
        }

        .dark .bg-gray-50 {
            background-color: #0f172a;
        }

        .dark .bg-gray-100 {
            background-color: #1e293b;
        }

        .dark .hover\:bg-gray-50:hover {
            background-color: #334155;
        }

        .dark .hover\:bg-gray-100:hover {
            background-color: #475569;
        }

        /* Enhanced Animations */
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .scale-in {
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.95);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* New Enhanced Styles */
        .hero-gradient {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        }

        .card-hover {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .input-focus {
            transition: all 0.2s ease;
        }

        .input-focus:focus {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .progress-ring {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .button-pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .dark .glass-effect {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .prose pre {
            background-color: #1e293b;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
        }

        .prose code {
            background-color: rgba(0, 0, 0, 0.1);
            padding: 0.2em 0.4em;
            border-radius: 0.25rem;
            font-size: 0.875em;
        }

        .prose pre code {
            background-color: transparent;
            padding: 0;
            border-radius: 0;
            font-size: 0.875em;
        }

        .prose blockquote {
            border-left-width: 4px;
            border-left-color: #3b82f6;
            padding-left: 1rem;
            font-style: italic;
            color: #6b7280;
        }

        .prose table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .prose th,
        .prose td {
            border: 1px solid #e5e7eb;
            padding: 0.5rem;
        }

        .prose th {
            background-color: #f3f4f6;
        }

        .dark .prose th {
            background-color: #1e293b;
        }

        .dark .prose th,
        .dark .prose td {
            border-color: #334155;
        }

        .dark .prose blockquote {
            color: #94a3b8;
        }

        .dark .prose code {
            background-color: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 transition-colors duration-300">
    <div class="container mx-auto max-w-6xl p-4">
        <!-- Enhanced Header with Hero Section -->
        <div class="text-center mb-12 relative">
            <button id="darkModeToggle"
                class="absolute right-0 top-0 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                <i data-lucide="moon" class="h-6 w-6"></i>
            </button>
            <div class="hero-gradient rounded-2xl p-8 mb-8 text-white shadow-lg">
                <h1 class="text-5xl font-bold mb-4 animate-fade-in">AI-Powered Placement Prep Hub</h1>
                <p class="text-xl text-white/90 max-w-2xl mx-auto">
                    Generate personalized study notes with AI, track your progress, and ace your placement interviews.
                </p>
                <div class="mt-6 flex justify-center gap-4">
                    <a href="https://notiq.onrender.com/admin"
                        class="px-6 py-3 bg-white text-blue-600 rounded-lg font-medium hover:bg-blue-50 transition-colors">
                        Get Started
                    </a>
                    <a href="https://notiq.onrender.com"
                        class="px-6 py-3 border border-white text-white rounded-lg font-medium hover:bg-white/10 transition-colors">
                        Learn More
                    </a>
                </div>
            </div>
        </div>

        <!-- Enhanced Stats Cards -->
        <div class="grid md:grid-cols-4 gap-6 mb-12">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 card-hover">
                <div class="flex items-center">
                    <div class="p-3 bg-blue-100 dark:bg-blue-900 rounded-lg mr-4">
                        <i data-lucide="book-open" class="h-6 w-6 text-blue-600 dark:text-blue-400"></i>
                    </div>
                    <div>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white" id="sessions-count">0</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Study Sessions</p>
                    </div>
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 card-hover" style="animation-delay: 0.1s">
                <div class="flex items-center">
                    <div class="p-3 bg-green-100 dark:bg-green-900 rounded-lg mr-4">
                        <i data-lucide="target" class="h-6 w-6 text-green-600 dark:text-green-400"></i>
                    </div>
                    <div>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white" id="completed-count">0</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Topics Completed</p>
                    </div>
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 card-hover" style="animation-delay: 0.2s">
                <div class="flex items-center">
                    <div class="p-3 bg-purple-100 dark:bg-purple-900 rounded-lg mr-4">
                        <i data-lucide="clock" class="h-6 w-6 text-purple-600 dark:text-purple-400"></i>
                    </div>
                    <div>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white" id="timer-display">00:00:00</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Study Time</p>
                    </div>
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 card-hover" style="animation-delay: 0.3s">
                <div class="flex items-center">
                    <div class="p-3 bg-orange-100 dark:bg-orange-900 rounded-lg mr-4">
                        <i data-lucide="users" class="h-6 w-6 text-orange-600 dark:text-orange-400"></i>
                    </div>
                    <div>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">95%</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Success Rate</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Tabs -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg mb-8 overflow-hidden">
            <div class="flex border-b dark:border-gray-700">
                <button class="tab-button active px-6 py-4 font-medium text-sm rounded-tl-lg transition-colors"
                    onclick="switchTab('study')">
                    <div class="flex items-center">
                        <i data-lucide="book" class="h-5 w-5 mr-2"></i>
                        Study Session
                    </div>
                </button>
                <button class="tab-button px-6 py-4 font-medium text-sm transition-colors"
                    onclick="switchTab('progress')">
                    <div class="flex items-center">
                        <i data-lucide="trending-up" class="h-5 w-5 mr-2"></i>
                        Progress Tracker
                    </div>
                </button>
                <button class="tab-button px-6 py-4 font-medium text-sm rounded-tr-lg transition-colors"
                    onclick="switchTab('history')">
                    <div class="flex items-center">
                        <i data-lucide="history" class="h-5 w-5 mr-2"></i>
                        Study History
                    </div>
                </button>
            </div>

            <!-- Study Session Tab -->
            <div id="study-tab" class="tab-content active p-4 sm:p-6">
                <div class="grid lg:grid-cols-2 gap-4 sm:gap-8">
                    <!-- Enhanced Input Form -->
                    <div
                        class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl shadow-lg p-4 sm:p-8 scale-in">
                        <div class="flex items-center gap-3 mb-4 sm:mb-6">
                            <div class="p-2 bg-blue-100 dark:bg-blue-900 rounded-lg">
                                <i data-lucide="lightbulb" class="h-6 w-6 text-blue-600 dark:text-blue-400"></i>
                            </div>
                            <h2 class="text-xl sm:text-2xl font-bold dark:text-white">Create Study Plan</h2>
                        </div>
                        <p class="text-gray-600 dark:text-gray-400 mb-6 sm:mb-8 text-sm sm:text-base">Generate
                            AI-powered study notes tailored to your needs</p>

                        <form id="study-form" class="space-y-4 sm:space-y-6">
                            <div>
                                <label for="subject"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Subject</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i data-lucide="book" class="h-5 w-5 text-gray-400"></i>
                                    </div>
                                    <input type="text" id="subject"
                                        placeholder="e.g., Data Structures, Algorithms, System Design"
                                        class="w-full pl-10 pr-3 py-2 sm:py-3 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white input-focus">
                                </div>
                            </div>

                            <div>
                                <label for="topics"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Topics</label>
                                <div class="relative">
                                    <div class="absolute top-2 sm:top-3 left-3 pointer-events-none">
                                        <i data-lucide="list" class="h-5 w-5 text-gray-400"></i>
                                    </div>
                                    <textarea id="topics" rows="3"
                                        placeholder="Enter topics separated by commas&#10;e.g., Binary Trees, Graph Traversal, Dynamic Programming"
                                        class="w-full pl-10 pr-3 py-2 sm:py-3 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white input-focus"></textarea>
                                </div>
                            </div>

                            <div>
                                <label for="study-type"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Study
                                    Approach</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i data-lucide="target" class="h-5 w-5 text-gray-400"></i>
                                    </div>
                                    <select id="study-type"
                                        class="w-full pl-10 pr-3 py-2 sm:py-3 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white input-focus appearance-none">
                                        <option value="">Select study approach</option>
                                        <option value="revision">Revision - Quick Review</option>
                                        <option value="detailed-explanation">Detailed Explanation</option>
                                        <option value="in-depth-analysis">In-Depth Analysis</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                        <i data-lucide="chevron-down" class="h-5 w-5 text-gray-400"></i>
                                    </div>
                                </div>
                            </div>

                            <button type="submit" id="generate-btn"
                                class="w-full bg-blue-600 text-white py-2 sm:py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 transition-colors flex items-center justify-center gap-2 text-sm sm:text-base">
                                <i data-lucide="sparkles" class="h-5 w-5"></i>
                                Generate AI Notes
                            </button>
                        </form>

                        <!-- Enhanced Timer Controls -->
                        <div class="mt-6 sm:mt-8 p-4 sm:p-6 bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="clock" class="h-5 w-5 text-gray-600 dark:text-gray-400"></i>
                                    <span class="font-medium dark:text-white text-sm sm:text-base">Study Timer</span>
                                </div>
                                <span class="text-2xl sm:text-3xl font-mono dark:text-white"
                                    id="timer-display-main">00:00:00</span>
                            </div>
                            <div class="flex gap-2 sm:gap-3">
                                <button id="timer-toggle"
                                    class="flex-1 flex items-center justify-center px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-xs sm:text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-white transition-colors"
                                    onclick="toggleTimer()">
                                    <i data-lucide="play" class="h-4 w-4 mr-2" id="timer-icon"></i>
                                    <span id="timer-text">Start</span>
                                </button>
                                <button
                                    class="flex-1 flex items-center justify-center px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-xs sm:text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-white transition-colors"
                                    onclick="resetTimer()">
                                    <i data-lucide="rotate-ccw" class="h-4 w-4 mr-2"></i>
                                    Reset
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Generated Notes -->
                    <div class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl shadow-lg p-4 sm:p-8 scale-in"
                        style="animation-delay: 0.1s">
                        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                            <div class="flex items-center gap-3">
                                <div class="p-2 bg-purple-100 dark:bg-purple-900 rounded-lg">
                                    <i data-lucide="file-text" class="h-6 w-6 text-purple-600 dark:text-purple-400"></i>
                                </div>
                                <h2 class="text-xl sm:text-2xl font-bold dark:text-white">Generated Notes</h2>
                            </div>
                            <div class="flex flex-wrap gap-2 sm:gap-3">
                                <button id="save-btn"
                                    class="flex items-center px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-xs sm:text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-white disabled:opacity-50 transition-colors"
                                    onclick="saveStudySession()" disabled>
                                    <i data-lucide="save" class="h-4 w-4 mr-2"></i>
                                    Save
                                </button>
                                <button id="export-btn"
                                    class="flex items-center px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-xs sm:text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-white disabled:opacity-50 transition-colors"
                                    onclick="exportNotes()" disabled>
                                    <i data-lucide="download" class="h-4 w-4 mr-2"></i>
                                    Export
                                </button>
                                <button id="share-btn"
                                    class="flex items-center px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-xs sm:text-sm hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-white disabled:opacity-50 transition-colors"
                                    onclick="shareNotes()" disabled>
                                    <i data-lucide="share-2" class="h-4 w-4 mr-2"></i>
                                    Share
                                </button>
                            </div>
                        </div>

                        <div id="notes-container" class="notes-container">
                            <div id="loading-state" class="hidden flex items-center justify-center h-48 sm:h-64">
                                <div class="text-center">
                                    <div class="spinner mx-auto mb-4"></div>
                                    <p class="dark:text-white text-sm sm:text-base">Generating your personalized study
                                        notes...</p>
                                </div>
                            </div>
                            <div id="empty-state"
                                class="text-center text-gray-500 dark:text-gray-400 h-48 sm:h-64 flex items-center justify-center">
                                <div class="max-w-sm">
                                    <i data-lucide="file-text" class="h-12 w-12 mx-auto mb-4 text-gray-400"></i>
                                    <p class="text-sm sm:text-base">Your AI-generated study notes will appear here</p>
                                </div>
                            </div>
                            <div id="notes-content" class="hidden">
                                <div id="notes-text"
                                    class="prose dark:prose-invert max-w-none bg-gray-50 dark:bg-gray-700 p-4 sm:p-6 rounded-xl overflow-auto text-sm sm:text-base">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress Tab -->
            <div id="progress-tab" class="tab-content p-6">
                <div class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl shadow-lg p-8">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="p-2 bg-green-100 dark:bg-green-900 rounded-lg">
                            <i data-lucide="trending-up" class="h-6 w-6 text-green-600 dark:text-green-400"></i>
                        </div>
                        <h2 class="text-2xl font-bold dark:text-white">Progress Tracker</h2>
                    </div>
                    <p class="text-gray-600 dark:text-gray-400 mb-8">Track your learning progress across different
                        topics</p>

                    <div id="progress-content">
                        <div class="text-center text-gray-500 dark:text-gray-400 py-12">
                            <div class="max-w-sm mx-auto">
                                <i data-lucide="target" class="h-12 w-12 mx-auto mb-4 text-gray-400"></i>
                                <p>Enter topics in the Study Session tab to track your progress</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div id="history-tab" class="tab-content p-6">
                <div class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl shadow-lg p-8">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-orange-100 dark:bg-orange-900 rounded-lg">
                                <i data-lucide="history" class="h-6 w-6 text-orange-600 dark:text-orange-400"></i>
                            </div>
                            <h2 class="text-2xl font-bold dark:text-white">Study History</h2>
                        </div>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i data-lucide="search" class="h-5 w-5 text-gray-400"></i>
                            </div>
                            <input type="text" id="history-search" placeholder="Search history..."
                                class="pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white input-focus">
                        </div>
                    </div>
                    <p class="text-gray-600 dark:text-gray-400 mb-8">Review your previous study sessions</p>

                    <div id="history-content">
                        <div class="text-center text-gray-500 dark:text-gray-400 py-12">
                            <div class="max-w-sm mx-auto">
                                <i data-lucide="history" class="h-12 w-12 mx-auto mb-4 text-gray-400"></i>
                                <p>No study sessions yet. Create your first one!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full mx-4 transform transition-all scale-95 opacity-0"
            id="share-modal-content">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold dark:text-white">Share Notes</h3>
                    <button onclick="closeShareModal()"
                        class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i data-lucide="x" class="h-6 w-6"></i>
                    </button>
                </div>

                <div class="space-y-4">
                    <!-- Copy Link -->
                    <div class="flex items-center justify-between p-4 border dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer"
                        onclick="copyShareLink()">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-blue-100 dark:bg-blue-900 rounded-lg">
                                <i data-lucide="link" class="h-5 w-5 text-blue-600 dark:text-blue-400"></i>
                            </div>
                            <span class="font-medium dark:text-white">Copy Link</span>
                        </div>
                        <i data-lucide="copy" class="h-5 w-5 text-gray-400"></i>
                    </div>

                    <!-- Download PDF -->
                    <div class="flex items-center justify-between p-4 border dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer"
                        onclick="downloadPDF()">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-red-100 dark:bg-red-900 rounded-lg">
                                <i data-lucide="file-text" class="h-5 w-5 text-red-600 dark:text-red-400"></i>
                            </div>
                            <span class="font-medium dark:text-white">Download PDF</span>
                        </div>
                        <i data-lucide="download" class="h-5 w-5 text-gray-400"></i>
                    </div>

                    <!-- Share via Email -->
                    <div class="flex items-center justify-between p-4 border dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer"
                        onclick="shareViaEmail()">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-green-100 dark:bg-green-900 rounded-lg">
                                <i data-lucide="mail" class="h-5 w-5 text-green-600 dark:text-green-400"></i>
                            </div>
                            <span class="font-medium dark:text-white">Share via Email</span>
                        </div>
                        <i data-lucide="arrow-right" class="h-5 w-5 text-gray-400"></i>
                    </div>

                    <!-- Share to Social Media -->
                    <div class="grid grid-cols-3 gap-3 mt-6">
                        <button onclick="shareToSocial('twitter')"
                            class="flex items-center justify-center gap-2 p-3 border dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                            <i data-lucide="twitter" class="h-5 w-5 text-blue-400"></i>
                            <span class="text-sm dark:text-white">Twitter</span>
                        </button>
                        <button onclick="shareToSocial('linkedin')"
                            class="flex items-center justify-center gap-2 p-3 border dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                            <i data-lucide="linkedin" class="h-5 w-5 text-blue-600"></i>
                            <span class="text-sm dark:text-white">LinkedIn</span>
                        </button>
                        <button onclick="shareToSocial('facebook')"
                            class="flex items-center justify-center gap-2 p-3 border dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                            <i data-lucide="facebook" class="h-5 w-5 text-blue-600"></i>
                            <span class="text-sm dark:text-white">Facebook</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let studySessions = JSON.parse(localStorage.getItem('studySessions') || '[]');
        let completedTopics = JSON.parse(localStorage.getItem('completedTopics') || '[]');
        let currentTime = 0;
        let timerInterval = null;
        let isTimerRunning = false;
        let currentNotes = '';
        let isDarkMode = localStorage.getItem('darkMode') === 'true';

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function () {
            lucide.createIcons();
            updateStats();
            updateHistoryTab();

            // Initialize markdown-it
            window.md = window.markdownit({
                html: true,
                linkify: true,
                typographer: true,
                highlight: function (str, lang) {
                    if (lang && hljs.getLanguage(lang)) {
                        try {
                            return hljs.highlight(str, { language: lang }).value;
                        } catch (__) { }
                    }
                    return ''; // use external default escaping
                }
            });

            // Initialize dark mode
            const savedDarkMode = localStorage.getItem('darkMode') === 'true';
            if (savedDarkMode) {
                document.documentElement.classList.add('dark');
                document.querySelector('#darkModeToggle i').setAttribute('data-lucide', 'sun');
                lucide.createIcons();
            }

            // Form submission
            document.getElementById('study-form').addEventListener('submit', handleGenerateNotes);

            // Dark mode toggle
            document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);

            // History search
            document.getElementById('history-search').addEventListener('input', handleHistorySearch);
        });

        // Dark mode functions
        function toggleDarkMode() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', isDark);

            const icon = document.querySelector('#darkModeToggle i');
            icon.setAttribute('data-lucide', isDark ? 'sun' : 'moon');
            lucide.createIcons();
        }

        // History search
        function handleHistorySearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filteredSessions = studySessions.filter(session =>
                session.subject.toLowerCase().includes(searchTerm) ||
                session.topics.toLowerCase().includes(searchTerm)
            );
            updateHistoryTab(filteredSessions);
        }

        // Share notes
        function shareNotes() {
            if (!currentNotes) {
                alert('No notes to share');
                return;
            }
            openShareModal();
        }

        // Share modal functions
        function openShareModal() {
            const modal = document.getElementById('share-modal');
            const modalContent = document.getElementById('share-modal-content');
            modal.classList.remove('hidden');
            modal.classList.add('flex');

            // Trigger animation
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeShareModal() {
            const modal = document.getElementById('share-modal');
            const modalContent = document.getElementById('share-modal-content');

            // Trigger animation
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');

            setTimeout(() => {
                modal.classList.remove('flex');
                modal.classList.add('hidden');
            }, 200);
        }

        function copyShareLink() {
            const subject = document.getElementById('subject').value;
            const topics = document.getElementById('topics').value;
            const content = `# ${subject} - Study Notes\n\n## Topics: ${topics}\n\n${currentNotes}`;

            // Create a temporary textarea
            const textarea = document.createElement('textarea');
            textarea.value = content;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            // Show success message
            alert('Notes copied to clipboard!');
        }

        function downloadPDF() {
            const subject = document.getElementById('subject').value;
            const topics = document.getElementById('topics').value;
            const content = `# ${subject} - Study Notes\n\n## Topics: ${topics}\n\n${currentNotes}`;

            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${subject.replace(/\s+/g, '_')}_notes.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function shareViaEmail() {
            const subject = document.getElementById('subject').value;
            const topics = document.getElementById('topics').value;
            const content = `# ${subject} - Study Notes\n\n## Topics: ${topics}\n\n${currentNotes}`;

            const mailtoLink = `mailto:?subject=${encodeURIComponent(subject + ' - Study Notes')}&body=${encodeURIComponent(content)}`;
            window.location.href = mailtoLink;
        }

        function shareToSocial(platform) {
            const subject = document.getElementById('subject').value;
            const topics = document.getElementById('topics').value;
            const text = `Check out my study notes for ${subject} - ${topics}`;
            const url = encodeURIComponent(window.location.href);

            let shareUrl;
            switch (platform) {
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${url}`;
                    break;
                case 'linkedin':
                    shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${url}`;
                    break;
                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
                    break;
            }

            window.open(shareUrl, '_blank', 'width=600,height=400');
        }

        // Close modal when clicking outside
        document.getElementById('share-modal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeShareModal();
            }
        });

        // Tab switching
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab and activate button
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');

            // Update progress tab if switching to it
            if (tabName === 'progress') {
                updateProgressTab();
            }
        }

        // Timer functions
        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimerDisplay() {
            const timeStr = formatTime(currentTime);
            document.getElementById('timer-display').textContent = timeStr;
            document.getElementById('timer-display-main').textContent = timeStr;
        }

        function toggleTimer() {
            if (isTimerRunning) {
                clearInterval(timerInterval);
                document.getElementById('timer-icon').setAttribute('data-lucide', 'play');
                document.getElementById('timer-text').textContent = 'Start';
            } else {
                timerInterval = setInterval(() => {
                    currentTime++;
                    updateTimerDisplay();
                }, 1000);
                document.getElementById('timer-icon').setAttribute('data-lucide', 'pause');
                document.getElementById('timer-text').textContent = 'Pause';
            }
            isTimerRunning = !isTimerRunning;
            lucide.createIcons();
        }

        function resetTimer() {
            clearInterval(timerInterval);
            currentTime = 0;
            isTimerRunning = false;
            updateTimerDisplay();
            document.getElementById('timer-icon').setAttribute('data-lucide', 'play');
            document.getElementById('timer-text').textContent = 'Start';
            lucide.createIcons();
        }

        // Generate notes using server
        async function generateNotesWithServer(subject, topics, studyType) {
            try {
                const response = await fetch('/.netlify/functions/generate-notes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        subject,
                        topics,
                        studyType
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to generate notes');
                }

                const data = await response.json();
                return data.notes;
            } catch (error) {
                console.error('Error generating notes:', error);
                throw new Error('Failed to generate notes. Please try again.');
            }
        }

        // Handle generate notes
        async function handleGenerateNotes(e) {
            e.preventDefault();

            const subject = document.getElementById('subject').value;
            const topics = document.getElementById('topics').value;
            const studyType = document.getElementById('study-type').value;

            if (!subject || !topics || !studyType) {
                alert('Please fill in all fields');
                return;
            }

            // Start timer if not running
            if (!isTimerRunning) {
                toggleTimer();
            }

            // Show loading state
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('notes-content').classList.add('hidden');
            document.getElementById('loading-state').classList.remove('hidden');

            const generateBtn = document.getElementById('generate-btn');
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating Notes...';

            try {
                // Generate notes using server
                const notes = await generateNotesWithServer(subject, topics, studyType);

                // Display notes
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('notes-content').classList.remove('hidden');
                const renderedNotes = window.md.render(notes);
                document.getElementById('notes-text').innerHTML = renderedNotes;

                // Apply syntax highlighting to code blocks
                document.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightBlock(block);
                });

                currentNotes = notes;

                // Enable save and export buttons
                document.getElementById('save-btn').disabled = false;
                document.getElementById('export-btn').disabled = false;
                document.getElementById('share-btn').disabled = false;

            } catch (error) {
                alert(error.message || 'Failed to generate notes. Please try again.');
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('empty-state').classList.remove('hidden');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate AI Notes';
            }
        }

        // Save study session
        function saveStudySession() {
            const subject = document.getElementById('subject').value;
            const topics = document.getElementById('topics').value;
            const studyType = document.getElementById('study-type').value;

            if (!subject || !topics || !currentNotes) {
                alert('Please generate notes first');
                return;
            }

            const newSession = {
                id: Date.now().toString(),
                subject,
                topics,
                studyType,
                notes: currentNotes,
                createdAt: new Date().toISOString(),
                timeSpent: currentTime
            };

            studySessions.unshift(newSession);
            localStorage.setItem('studySessions', JSON.stringify(studySessions));

            updateStats();
            updateHistoryTab();
            alert('Study session saved!');
        }

        // Export notes
        function exportNotes() {
            if (!currentNotes) {
                alert('No notes to export');
                return;
            }

            const subject = document.getElementById('subject').value;
            const topics = document.getElementById('topics').value;
            const studyType = document.getElementById('study-type').value;

            const content = `# ${subject} - Study Notes\n\n## Topics: ${topics}\n\n## Study Type: ${studyType}\n\n${currentNotes}`;

            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${subject.replace(/\s+/g, '_')}_notes.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Load study session
        function loadStudySession(session) {
            document.getElementById('subject').value = session.subject;
            document.getElementById('topics').value = session.topics;
            document.getElementById('study-type').value = session.studyType;

            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('notes-content').classList.remove('hidden');
            document.getElementById('notes-text').textContent = session.notes;

            currentNotes = session.notes;

            document.getElementById('save-btn').disabled = false;
            document.getElementById('export-btn').disabled = false;

            // Switch to study tab
            switchTab('study');
            document.querySelector('.tab-button').click();
        }

        // Mark topic as complete
        function markTopicComplete(topic) {
            if (!completedTopics.includes(topic)) {
                completedTopics.push(topic);
                localStorage.setItem('completedTopics', JSON.stringify(completedTopics));
                updateStats();
                updateProgressTab();
            }
        }

        // Update stats
        function updateStats() {
            document.getElementById('sessions-count').textContent = studySessions.length;
            document.getElementById('completed-count').textContent = completedTopics.length;
        }

        // Update progress tab
        function updateProgressTab() {
            const topics = document.getElementById('topics').value;
            const progressContent = document.getElementById('progress-content');

            if (!topics.trim()) {
                progressContent.innerHTML = `
                    <div class="text-center text-gray-500 dark:text-gray-400 py-12">
                        <div class="max-w-sm mx-auto">
                            <i data-lucide="target" class="h-12 w-12 mx-auto mb-4 text-gray-400"></i>
                            <p>Enter topics in the Study Session tab to track your progress</p>
                        </div>
                    </div>
                `;
                return;
            }

            const topicList = topics.split(',').map(t => t.trim());
            const completedCount = topicList.filter(topic => completedTopics.includes(topic)).length;
            const progressPercentage = (completedCount / topicList.length) * 100;

            progressContent.innerHTML = `
                <div class="space-y-8">
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-6">
                        <div class="flex justify-between items-center mb-4">
                            <span class="font-medium dark:text-white">Overall Progress</span>
                            <span class="text-2xl font-bold text-blue-600 dark:text-blue-400">${Math.round(progressPercentage)}%</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                            <div class="bg-blue-600 h-3 rounded-full progress-bar" style="width: ${progressPercentage}%"></div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <h4 class="font-medium dark:text-white">Topics:</h4>
                        <div class="grid gap-3">
                            ${topicList.map(topic => {
                const isCompleted = completedTopics.includes(topic);
                return `
                                    <div class="flex items-center justify-between p-4 border dark:border-gray-700 rounded-xl topic-item ${isCompleted ? 'completed bg-gray-50 dark:bg-gray-700' : ''}">
                                        <div class="flex items-center gap-3">
                                            <div class="p-2 ${isCompleted ? 'bg-green-100 dark:bg-green-900' : 'bg-gray-100 dark:bg-gray-800'} rounded-lg">
                                                <i data-lucide="${isCompleted ? 'check-circle' : 'circle'}" class="h-5 w-5 ${isCompleted ? 'text-green-600 dark:text-green-400' : 'text-gray-400'}"></i>
                                            </div>
                                            <span class="font-medium dark:text-white">${topic}</span>
                                        </div>
                                        <button 
                                            class="px-4 py-2 text-sm border rounded-lg ${isCompleted ? 'bg-gray-100 dark:bg-gray-800 text-gray-500' : 'hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-white'} transition-colors"
                                            onclick="markTopicComplete('${topic}')"
                                            ${isCompleted ? 'disabled' : ''}
                                        >
                                            ${isCompleted ? 'Completed' : 'Mark Complete'}
                                        </button>
                                    </div>
                                `;
            }).join('')}
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        // Update history tab with search support
        function updateHistoryTab(sessions = studySessions) {
            const historyContent = document.getElementById('history-content');

            if (sessions.length === 0) {
                historyContent.innerHTML = `
                    <div class="text-center text-gray-500 dark:text-gray-400 py-12">
                        <div class="max-w-sm mx-auto">
                            <i data-lucide="history" class="h-12 w-12 mx-auto mb-4 text-gray-400"></i>
                            <p>No study sessions found</p>
                        </div>
                    </div>
                `;
                return;
            }

            historyContent.innerHTML = `
                <div class="space-y-4">
                    ${sessions.map(session => `
                        <div class="border dark:border-gray-700 rounded-xl p-6 fade-in hover:shadow-lg transition-shadow">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <div class="flex items-center gap-2 mb-2">
                                        <div class="p-2 bg-blue-100 dark:bg-blue-900 rounded-lg">
                                            <i data-lucide="book" class="h-5 w-5 text-blue-600 dark:text-blue-400"></i>
                                        </div>
                                        <h4 class="font-medium dark:text-white">${session.subject}</h4>
                                    </div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">${session.topics}</p>
                                </div>
                                <div class="text-right">
                                    <span class="inline-block px-3 py-1 text-xs bg-gray-100 dark:bg-gray-700 rounded-full dark:text-white">${session.studyType}</span>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                                        <i data-lucide="clock" class="h-4 w-4 inline-block mr-1"></i>
                                        ${formatTime(session.timeSpent)} • ${new Date(session.createdAt).toLocaleDateString()}
                                    </p>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <button 
                                    class="flex-1 flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-white transition-colors"
                                    onclick="loadStudySession(${JSON.stringify(session).replace(/"/g, '&quot;')})"
                                >
                                    <i data-lucide="refresh-cw" class="h-4 w-4 mr-2"></i>
                                    Load Session
                                </button>
                                <button 
                                    class="flex-1 flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-white transition-colors"
                                    onclick="deleteStudySession('${session.id}')"
                                >
                                    <i data-lucide="trash-2" class="h-4 w-4 mr-2"></i>
                                    Delete
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            lucide.createIcons();
        }

        // Delete study session
        function deleteStudySession(sessionId) {
            if (confirm('Are you sure you want to delete this study session?')) {
                studySessions = studySessions.filter(session => session.id !== sessionId);
                localStorage.setItem('studySessions', JSON.stringify(studySessions));
                updateStats();
                updateHistoryTab();
            }
        }

        tailwind.config = {
            theme: {
                extend: {
                    typography: {
                        DEFAULT: {
                            css: {
                                maxWidth: 'none',
                                color: 'inherit',
                                a: {
                                    color: '#3b82f6',
                                    '&:hover': {
                                        color: '#2563eb',
                                    },
                                },
                                'h1, h2, h3, h4': {
                                    color: 'inherit',
                                },
                                code: {
                                    color: 'inherit',
                                },
                                pre: {
                                    backgroundColor: '#1e293b',
                                },
                                blockquote: {
                                    borderLeftColor: '#3b82f6',
                                },
                            },
                        },
                    },
                },
            },
        }
    </script>
</body>

</html>